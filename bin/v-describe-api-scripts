#!/bin/bash
# info: Displays all scripts in a group or list with the argument position "USER"
# options: SCRIPTS [FORMAT]
#
# example: v-describe-api-scripts mail-accounts,purge-nginx-cache json

#----------------------------------------------------------#
#                Variables & Functions                     #
#----------------------------------------------------------#

# Argument definition
scripts=$1
format="${2:-shell}"

# Includes
# shellcheck source=/etc/hestiacp/hestia.conf
source /etc/hestiacp/hestia.conf
# shellcheck source=/usr/local/hestia/func/main.sh
source $HESTIA/func/main.sh
# load config file
source_conf "$HESTIA/conf/hestia.conf"

# JSON list function
json_list() {
    echo '{'
    local quote=''
    for script_name in "${raw_scripts[@]}"; do
        echo -en "$quote"
        echo -n '    "'$script_name'": "'$(get_user_param_position "$script_name")'"'
        quote=",\n"
    done
    echo -e '\n}'
}

# SHELL list function
shell_list() {
    list="Script\tUser Argument\n"
    list+="------\t-------------\n"

    for script_name in "${raw_scripts[@]}"; do
        list+="${script_name}\t$(get_user_param_position "$script_name")\n"
    done
    echo -e "$list" | column -t -s "	"
}

#----------------------------------------------------------#
#                    Verifications                         #
#----------------------------------------------------------#

check_args '1' "$#" 'SCRIPTS [FORMAT]'

#----------------------------------------------------------#
#                       Action                             #
#----------------------------------------------------------#

read -a raw_scripts <<< "$(get_raw_scripts "$scripts" | sed -E "s/,+/\ /g")"

# Listing data
case $format in
    json)   json_list ;;
    shell)  shell_list ;;
esac

#----------------------------------------------------------#
#                       Hestia                             #
#----------------------------------------------------------#

exit
