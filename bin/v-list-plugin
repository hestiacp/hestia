#!/usr/bin/env bash
# info: show plugin info
# options: PLUGIN_NAME
#
# example: v-list-plugin pluginname

#----------------------------------------------------------#
#                Variables & Functions                     #
#----------------------------------------------------------#

plugin_name="$1"
format="${2:-shell}"

# shellcheck source=/etc/hestiacp/hestia.conf
source /etc/hestiacp/hestia.conf
# shellcheck source=/usr/local/hestia/func/main.sh
source $HESTIA/func/main.sh
# shellcheck source=/usr/local/hestia/func/plugins.sh
source $HESTIA/func/plugins.sh
# load config file
source_conf "$HESTIA/conf/hestia.conf"

#----------------------------------------------------------#
#                    Verifications                         #
#----------------------------------------------------------#

check_args '1' "$#" 'PLUGIN_NAME'

init_plugins_conf_if_not_exists

plugin_name="$(echo "$plugin_name" | awk '{gsub(/^[ \t]+| [ \t]+$/,""); print $0 }')"
plugins_list="$(cat "$HESTIA/conf/plugins.json")"
plugin="$(echo "${plugins_list}" | jq -r ".\"$plugin_name\"")"

#----------------------------------------------------------#
#                       Action                             #
#----------------------------------------------------------#

if [[ "$plugin" && "$plugin" != "null" ]]; then
    case "$format" in
        json)   echo "$plugin" ;;
        plain)  json_to 'plain' "[$plugin]" "name|version|repository|enabled|date" ;;
        shell)  json_to 'shell' "[$plugin]" "name|version|repository|enabled|date" ;;
        csv)    json_to 'csv' "[$plugin]" "name|version|repository|enabled|date|description" ;;
    esac
fi
